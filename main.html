<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ‰¹é‡å›¾ç‰‡æ ‡æ³¨å·¥å…·</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            content: ["./**/*.{html,css}"],
            important: true
        }
    </script>
    <!-- å¼•å…¥ JSZip ç”¨äºæ‰“åŒ…ä¸‹è½½ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- å¼•å…¥å¡ç‰Œå­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Cinzel:wght@700&family=Noto+Serif+SC:wght@700&display=swap" rel="stylesheet">
    <!-- å¼•å…¥è‡ªå®šä¹‰æ ·å¼ -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="antialiased">
<div id="app-container">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-yellow-300" style="font-family: 'Cinzel', serif;">AI å›¾ç‰‡æ‰“æ ‡å™¨</h1>
            <p class="mt-2 text-lg text-gray-300">ç”Ÿæˆæç¤ºè¯</p>
        </header>

        <!-- å¸ƒå±€ä¿®å¤ï¼šæ¨¡å—åŒ–é…ç½®å¡ç‰‡ -->
        <div class="space-y-8">
            <!-- é…ç½®å¡ç‰‡è¡Œ -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="config-item-card">
                    <label for="apiKey" class="form-label block text-sm font-medium mb-2">API Key <span class="text-red-500">*</span></label>
                    <input type="password" id="apiKey" class="form-input" placeholder="è¯·åœ¨æ­¤è¾“å…¥æ‚¨çš„ API Key">
                </div>
                <div class="config-item-card">
                    <label for="baseURL" class="form-label block text-sm font-medium mb-2">Base URL (å¯é€‰)</label>
                    <input type="text" id="baseURL" class="form-input" placeholder="é»˜è®¤: openrouter.ai">
                </div>
                <div class="config-item-card">
                    <label for="model" class="form-label block text-sm font-medium mb-2">æ¨¡å‹</label>
                    <input type="text" id="model" class="form-input" value="google/gemini-2.0-flash-exp:free" placeholder="è¾“å…¥è¦ä½¿ç”¨çš„æ¨¡å‹">
                </div>
                <div class="config-item-card">
                    <label for="themeSelector" class="form-label block text-sm font-medium mb-2">ç•Œé¢é£æ ¼</label>
                    <select id="themeSelector" class="form-input">
                        <option value="styles1">æ ·å¼1</option>
                        <option value="styles2">æ ·å¼2</option>
                    </select>
                </div>
            </div>

            <!-- æç¤ºè¯å¡ç‰‡è¡Œ -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                 <div class="config-item-card">
                    <label for="systemPrompt" class="form-label block text-sm font-medium mb-2">ç³»ç»Ÿæç¤ºè¯</label>
                    <textarea id="systemPrompt" class="form-input h-32 resize-none">éœ€è¦æè¿°çš„æœ‰èƒŒæ™¯,åŠ¨ä½œ,è¡¨æƒ…,æœè£…,ä¸éœ€è¦æè¿°çš„ä¸ºäººç‰©ç‰¹å¾,ç”¨å¤šä¸ªtagæ¥æè¿°,è€Œä¸æ˜¯è¿ç»­çš„æ–‡æœ¬,ä¸è¦åˆ†ç±»,ç›´æ¥å°†æ‰€æœ‰æè¿°éƒ½ç”¨é€—å·åˆ†éš”

å®ä¾‹:çº¢é»‘ç›¸é—´çš„è¿è¡£è£™,è•¾ä¸è£…é¥°,é»‘è‰²é¡¹åœˆ,çº¢è‰²è´è¶ç»“</textarea>
                </div>
                 <div class="config-item-card">
                    <label for="userPrompt" class="form-label block text-sm font-medium mb-2">ç”¨æˆ·æç¤ºè¯ <span class="text-red-500">*</span></label>
                    <textarea id="userPrompt" class="form-input h-32 resize-none">æè¿°å›¾ç‰‡,ä¸è¦å‡ºç°äººç‰©æè¿°</textarea>
                </div>
            </div>

            <!-- è§¦å‘è¯è¾“å…¥æ¡† -->
            <div class="grid grid-cols-1 gap-6">
                <div class="config-item-card">
                    <label for="triggerPrompt" class="form-label block text-sm font-medium mb-2">è§¦å‘è¯ (å°†æ·»åŠ åˆ°æ‰€æœ‰æè¿°æœ«å°¾)</label>
                    <div class="flex gap-4">
                        <input type="text" id="triggerPrompt" class="form-input flex-grow" placeholder="è¾“å…¥è¦æ·»åŠ çš„è§¦å‘è¯">
                        <button id="addTriggerBtn" class="btn btn-secondary min-w-[120px]">
                            <span>ğŸ“ æ·»åŠ </span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- æŒ‰é’®ç»„ -->
            <div class="button-group-container">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6">
                    <div class="action-btn-card">
                        <button id="clearAllBtn" class="btn btn-secondary">
                            <span>ğŸ—‘ï¸ æ¸…é™¤å…¨éƒ¨</span>
                        </button>
                    </div>
                    <div class="action-btn-card">
                        <label for="imageUpload" class="btn cursor-pointer">
                            <span>ğŸ“¤ é€‰æ‹©å›¾ç‰‡</span>
                            <input type="file" id="imageUpload" class="hidden" multiple accept="image/png, image/jpeg, image/gif, image/webp">
                        </label>
                    </div>
                    <div class="action-btn-card">
                        <button id="processBtn" class="btn btn-primary">
                            <span>âœ¨ å¼€å§‹ç”Ÿæˆ</span>
                        </button>
                    </div>
                    <div class="action-btn-card">
                        <button id="exportJsonBtn" class="btn btn-secondary">
                            <span>ğŸ“„ å¯¼å‡º JSON</span>
                        </button>
                    </div>
                    <div class="action-btn-card">
                        <button id="exportZipBtn" class="btn btn-secondary">
                            <span>ğŸ—‚ï¸ å¯¼å‡º ZIP</span>
                        </button>
                    </div>
                </div>
                 <div id="error-message" class="text-red-400 text-center font-medium pt-4 px-6"></div>
            </div>
        </div>


        <div id="status" class="text-center my-4 font-medium text-lg text-indigo-400 hidden"><div class="flex items-center justify-center gap-3"><div class="loader w-6 h-6 border-4 border-gray-500 rounded-full"></div><span id="status-text"></span></div></div>
        
        <!-- ç»“æœå±•ç¤ºåŒº -->
        <div id="results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-12"></div>
    </div>
</div>

    <!-- é«˜çº§ç¼–è¾‘ Modal -->
    <div id="edit-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-gray-100 rounded-2xl w-full max-w-6xl h-full max-h-[90vh] flex flex-col shadow-2xl">
            <div class="flex justify-between items-center p-4 border-b bg-white rounded-t-2xl">
                <h3 class="text-xl font-semibold">é«˜çº§ç¼–è¾‘æ¨¡å¼</h3>
                <button id="modal-close-btn" class="text-gray-400 hover:text-gray-800">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-4 overflow-hidden p-4">
                <div class="bg-white rounded-lg flex items-center justify-center p-4 overflow-hidden relative">
                    <img id="modal-image" src="" class="max-w-full max-h-full object-contain">
                </div>
                <div class="bg-white rounded-lg flex flex-col p-4 overflow-hidden">
                    <label for="modal-edit-textarea" class="text-lg font-semibold mb-4 block">ç¼–è¾‘å›¾ç‰‡æè¿°</label>
                    <textarea id="modal-edit-textarea" class="form-input flex-grow w-full h-full resize-none no-scrollbar"></textarea>
                    <div class="mt-4">
                        <button id="modal-save-btn" class="btn btn-primary">
                           <span>ğŸ’¾ ä¿å­˜æ›´æ”¹</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const appContainer = document.getElementById('app-container');
        const apiKeyInput = document.getElementById('apiKey');
        const baseURLInput = document.getElementById('baseURL');
        const userPromptInput = document.getElementById('userPrompt');
        const systemPromptInput = document.getElementById('systemPrompt');
        const imageUpload = document.getElementById('imageUpload');
        const processBtn = document.getElementById('processBtn');
        const exportJsonBtn = document.getElementById('exportJsonBtn');
        const exportZipBtn = document.getElementById('exportZipBtn');
        const resultsContainer = document.getElementById('results');
        const statusDiv = document.getElementById('status');
        const statusText = document.getElementById('status-text');
        const errorMessageDiv = document.getElementById('error-message');
        const themeSelector = document.getElementById('themeSelector');
        
        // Modal Elements
        const editModal = document.getElementById('edit-modal');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const modalImage = document.getElementById('modal-image');
        const modalEditarea = document.getElementById('modal-edit-textarea');
        const modalSaveBtn = document.getElementById('modal-save-btn');

        let imageFiles = [];

        // --- Event Listeners ---
        imageUpload.addEventListener('change', handleImageUpload);
        apiKeyInput.addEventListener('input', validateInputs);
        userPromptInput.addEventListener('input', validateInputs);
        processBtn.addEventListener('click', processImages);
        exportJsonBtn.addEventListener('click', exportAsJSON);
        exportZipBtn.addEventListener('click', exportAsZIP);
        resultsContainer.addEventListener('click', handleResultCardClick);
        modalCloseBtn.addEventListener('click', closeEditModal);
        modalSaveBtn.addEventListener('click', saveModalChanges);
        themeSelector.addEventListener('change', applyTheme);

        const clearAllBtn = document.getElementById('clearAllBtn');
        clearAllBtn.addEventListener('click', clearAllImages);

        // ä¿®æ”¹äº‹ä»¶ç›‘å¬å¤„ç†
        resultsContainer.addEventListener('click', function(event) {
            const deleteBtn = event.target.closest('.delete-btn');
            if (deleteBtn) {
                event.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                const card = deleteBtn.closest('.result-card');
                if (card) {
                    const filename = card.getAttribute('data-filename');
                    deleteImage(filename);
                }
                return;
            }
            
            handleResultCardClick(event);
        });

        // --- Functions ---
        function applyTheme() {
            const selectedTheme = themeSelector.value;
            appContainer.className = `theme-${selectedTheme}`;  // ç›´æ¥è®¾ç½®ä¸ºé€‰å®šä¸»é¢˜
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            themeSelector.value = 'styles2';  // ä¿®æ”¹é»˜è®¤ä¸»é¢˜
            applyTheme();  // åº”ç”¨é»˜è®¤ä¸»é¢˜
        });

        function handleImageUpload(event) {
            imageFiles = Array.from(event.target.files);
            resultsContainer.innerHTML = '';
            exportJsonBtn.disabled = true;
            exportZipBtn.disabled = true;
            
            // ä½¿ç”¨Promise.allç¡®ä¿æŒ‰é¡ºåºå¤„ç†
            const readers = imageFiles.map(file => {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        resolve({ file, result: e.target.result });
                    };
                    reader.readAsDataURL(file);
                });
            });

            Promise.all(readers).then(results => {
                results.forEach(({ file, result }) => {
                    createResultCard(file.name, result);
                });
                validateInputs();
            });
        }

        function createResultCard(filename, imageSrc) {
            const card = document.createElement('div');
            card.className = 'result-card relative';
            card.setAttribute('data-filename', filename);
            
            card.innerHTML = `
                <!-- Both theme structures are present, CSS will toggle visibility -->
                <div class="styles1-elements">
                    <div class="card-frame">
                        <div class="card-header">
                            <span class="truncate pr-2">${filename.split('.').slice(0,-1).join('.') || filename}</span>
                            <div class="flex items-center gap-2">
                                <span class="image-dimensions">...</span>
                                <button class="delete-btn" title="åˆ é™¤">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="card-image-container relative aspect-[1/1] clickable-image">
                            <img src="${imageSrc}" alt="${filename}" class="absolute top-0 left-0 h-full w-full object-cover">
                        </div>
                        <div class="card-body">
                            <div class="flex justify-between items-center mb-2">
                                <span class="description-header">ã€æ–‡æœ¬æè¿°ã€‘</span>
                                <button class="advanced-edit-btn p-1 text-stone-600 hover:text-stone-900" title="é«˜çº§ç¼–è¾‘"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg></button>
                            </div>
                            <textarea class="caption-textarea w-full h-24 resize-none no-scrollbar" placeholder="ç­‰å¾…AIç”Ÿæˆæè¿°..."></textarea>
                            <div class="holo-foil"></div>
                        </div>
                    </div>
                </div>

                <div class="styles2-elements">
                     <div class="card-frame">
                        <div class="card-header">
                            <span class="styles2-name truncate">${filename.split('.').slice(0,-1).join('.') || filename}</span>
                            <div class="flex items-center gap-2">
                                <span class="image-dimensions">...</span>
                                <button class="delete-btn" title="åˆ é™¤">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="card-image-container relative aspect-[4/5] clickable-image">
                            <img src="${imageSrc}" alt="${filename}" class="absolute top-0 left-0 h-full w-full object-cover">
                        </div>
                        <div class="card-body">
                             <div class="flex justify-between items-center mb-1">
                                <span class="description-header">ã€æ–‡æœ¬æè¿°ã€‘</span>
                                <button class="advanced-edit-btn p-1 text-stone-600 hover:text-stone-900" title="é«˜çº§ç¼–è¾‘"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg></button>
                            </div>
                            <textarea class="caption-textarea w-full resize-none no-scrollbar" placeholder="ç­‰å¾…AIç”Ÿæˆæè¿°..."></textarea>
                        </div>
                    </div>
                </div>
                <small class="error-text absolute -bottom-6 left-0 text-red-400 text-xs w-full text-center"></small>
            `;

            resultsContainer.appendChild(card);
            
            const imgElement = card.querySelector('img');
            imgElement.onload = () => {
                const dimensionsSpans = card.querySelectorAll('.image-dimensions');
                dimensionsSpans.forEach(span => {
                    span.textContent = `${imgElement.naturalWidth}x${imgElement.naturalHeight}`;
                });
            };
        }
        
        function handleResultCardClick(event){
            // å¦‚æœç‚¹å‡»çš„æ˜¯åˆ é™¤æŒ‰é’®ï¼Œä¸å¤„ç†ç¼–è¾‘äº‹ä»¶
            if (event.target.closest('.delete-btn')) {
                return;
            }
            
            const editBtn = event.target.closest('.advanced-edit-btn');
            const imageContainer = event.target.closest('.clickable-image');

            if (editBtn || imageContainer) {
                const card = event.target.closest('.result-card');
                if (card) {
                    const filename = card.getAttribute('data-filename');
                    openEditModal(filename);
                }
            }
        }

        function openEditModal(filename) {
            const card = document.querySelector(`.result-card[data-filename="${filename}"]`);
            const imgSrc = card.querySelector('img').src;
            const currentCaption = card.querySelector('textarea').value;
            
            const modal = document.getElementById('edit-modal');
            const modalImg = modal.querySelector('#modal-image');
            const modalTextarea = modal.querySelector('#modal-edit-textarea');

            modalImg.src = imgSrc;
            modalTextarea.value = currentCaption;
            modal.setAttribute('data-target-filename', filename);
            modal.classList.remove('hidden');
        }

        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
        }

        function saveModalChanges() {
            const modal = document.getElementById('edit-modal');
            const filename = modal.getAttribute('data-target-filename');
            if (!filename) return;

            const card = document.querySelector(`.result-card[data-filename="${filename}"]`);
            const cardTextarea = card.querySelector('textarea');
            const modalTextarea = modal.querySelector('#modal-edit-textarea');
            
            cardTextarea.value = modalTextarea.value;
            closeEditModal();
        }

        function validateInputs() {
            const isReady = apiKeyInput.value.trim() !== '' && userPromptInput.value.trim() !== '' && imageFiles.length > 0;
            processBtn.disabled = !isReady;
            errorMessageDiv.textContent = '';
        }

        function readImageAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = (error) => reject(error);
                reader.readAsDataURL(file);
            });
        }

        async function callVisionAPI(apiKey, base64Image, systemPrompt, userPrompt) {
            const baseUrl = baseURLInput.value.trim() || 'https://openrouter.ai/api/v1';
            const apiUrl = `${baseUrl.replace(/\/$/, '')}/chat/completions`;

            try {
                const messages = [];
                if (systemPrompt.trim()) messages.push({ role: "system", content: systemPrompt.trim() });
                messages.push({
                    role: "user",
                    content: [
                        { type: "text", text: userPrompt },
                        { type: "image_url", image_url: { url: base64Image } }
                    ]
                });
                
                // åªä¿ç•™åŸºç¡€å¿…éœ€çš„headers
                const headers = {
                    "Authorization": `Bearer ${apiKey}`,
                    "Content-Type": "application/json"
                };
                
                const response = await fetch(apiUrl, {
                    method: "POST",
                    headers,
                    body: JSON.stringify({ 
                        model: document.getElementById('model').value, 
                        messages 
                    })
                });
                
                // ç›´æ¥è·å–å¹¶æ˜¾ç¤ºåŸå§‹å“åº”
                const responseText = await response.text();
                
                if (!response.ok) {
                    throw new Error(responseText);
                }
                
                const result = JSON.parse(responseText);
                return result.choices[0].message.content;
                
            } catch (error) {
                // ä¸å¤„ç†é”™è¯¯æ¶ˆæ¯,ç›´æ¥æŠ›å‡º
                throw error;
            }
        }

        async function processImages() {
            if (apiKeyInput.value.trim() === '' || imageFiles.length === 0) {
                showError("è¯·ç¡®ä¿å·²è¾“å…¥API Keyå¹¶é€‰æ‹©äº†å›¾ç‰‡ã€‚"); return;
            }
            setProcessingState(true);
            let processedCount = 0;
            const apiKey = apiKeyInput.value.trim();

            for (let i = 0; i < imageFiles.length; i++) {
                const file = imageFiles[i];
                statusText.textContent = `æ­£åœ¨å¤„ç†ç¬¬ ${i + 1} / ${imageFiles.length} å¼ å›¾ç‰‡: ${file.name}`;
                const card = document.querySelector(`.result-card[data-filename="${file.name}"]`);
                const textareas = card.querySelectorAll('.caption-textarea');  // è·å–æ‰€æœ‰æ–‡æœ¬æ¡†
                const errorText = card.querySelector('.error-text');
                card.classList.remove('error');
                errorText.textContent = '';
                try {
                    const base64Image = await readImageAsBase64(file);
                    const content = await callVisionAPI(apiKey, base64Image, systemPromptInput.value, userPromptInput.value);
                    // ä¸ºæ‰€æœ‰ä¸»é¢˜çš„æ–‡æœ¬æ¡†éƒ½è®¾ç½®å†…å®¹
                    textareas.forEach(textarea => {
                        textarea.value = content;
                    });
                    processedCount++;
                } catch (error) {
                    errorText.textContent = `å¤„ç†å¤±è´¥: ${error.message}`;
                    card.classList.add('error');
                }
            }
            
            setProcessingState(false, `å¤„ç†å®Œæˆï¼æˆåŠŸ ${processedCount} å¼ ï¼Œå¤±è´¥ ${imageFiles.length - processedCount} å¼ ã€‚`);
            if(getResultsData().length > 0){
                exportJsonBtn.disabled = false;
                exportZipBtn.disabled = false;
            }
        }
        
        function setProcessingState(isProcessing, message = "") {
            processBtn.disabled = isProcessing;
            imageUpload.disabled = isProcessing;
            if (isProcessing) {
                statusDiv.classList.remove('hidden');
            } else {
                statusText.textContent = message;
                setTimeout(() => statusDiv.classList.add('hidden'), 5000);
            }
        }

        function getResultsData() {
            const results = [];
            document.querySelectorAll('.result-card').forEach(card => {
                const filename = card.getAttribute('data-filename');
                const caption = card.querySelector('textarea').value;
                if(caption.trim() !== '') results.push({ filename, caption });
            });
            return results;
        }

        function exportAsJSON() {
            const results = getResultsData();
            if (results.length === 0) { showError("æ²¡æœ‰å¯å¯¼å‡ºçš„æè¿°ã€‚"); return; }
            const jsonString = JSON.stringify(results, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            triggerDownload(blob, 'captions.json');
        }

        async function exportAsZIP() {
            const results = getResultsData();
            if (results.length === 0) { showError("æ²¡æœ‰å¯å¯¼å‡ºçš„æè¿°ã€‚"); return; }
            const zip = new JSZip();
            results.forEach(result => {
                const txtFilename = result.filename.split('.').slice(0, -1).join('.') + '.txt';
                zip.file(txtFilename, result.caption);
            });
            const content = await zip.generateAsync({ type: 'blob' });
            triggerDownload(content, 'captions.zip');
        }
        
        function triggerDownload(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function showError(message) {
            errorMessageDiv.textContent = message;
            setTimeout(() => errorMessageDiv.textContent = '', 5000);
        }

        // ä¿®æ”¹åˆ é™¤å›¾ç‰‡åŠŸèƒ½
        function deleteImage(filename) {
            const card = document.querySelector(`.result-card[data-filename="${filename}"]`);
            if (card) {
                card.style.opacity = '0';
                card.style.transform = 'scale(0.9)';
                
                setTimeout(() => {
                    card.remove();
                    imageFiles = imageFiles.filter(file => file.name !== filename);
                    validateInputs();
                    
                    if (imageFiles.length === 0) {
                        exportJsonBtn.disabled = true;
                        exportZipBtn.disabled = true;
                    }
                }, 200);
            }
        }
        
        // æ·»åŠ æ¸…é™¤å…¨éƒ¨åŠŸèƒ½
        function clearAllImages() {
            resultsContainer.innerHTML = '';
            imageFiles = [];
            exportJsonBtn.disabled = true;
            exportZipBtn.disabled = true;
        }

        // æ·»åŠ è§¦å‘è¯åŠŸèƒ½
        document.getElementById('addTriggerBtn').addEventListener('click', function() {
            const triggerText = document.getElementById('triggerPrompt').value.trim();
            if (!triggerText) return;
            
            document.querySelectorAll('.caption-textarea').forEach(textarea => {
                const currentText = textarea.value.trim();
                if (currentText) {
                    textarea.value = currentText + ', ' + triggerText;
                } else {
                    textarea.value = triggerText;
                }
            });
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            document.getElementById('triggerPrompt').value = '';
        });
    </script>
</body>
</html>
